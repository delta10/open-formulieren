# Generated by Django 4.2.23 on 2025-07-09 07:42

from django.db import migrations


def update_intermediate_rol_results_name(apps, schema_editor):
    Submission = apps.get_model("submissions", "Submission")

    # we need to update only the zgw apis backend data
    # the registration_result JSON field does not have a default value that's why we query
    # against the rows that have None as a value
    submissions = Submission.objects.filter(
        form__registration_backends__backend="zgw-create-zaak"
    ).exclude(registration_result=None)

    for submission in submissions:
        if submission.registration_result.get("rol"):
            submission.registration_result["initiator_rol"] = (
                submission.registration_result.pop("rol")
            )

        if (
            intermediate_result := submission.registration_result.get("intermediate")
        ) and intermediate_result.get("rol"):
            intermediate_result["initiator_rol"] = intermediate_result.pop("rol")

        submission.save(update_fields=["registration_result"])


class Migration(migrations.Migration):
    dependencies = [
        ("submissions", "0004_set_co_sign_data_version"),
    ]

    operations = [
        migrations.RunPython(
            update_intermediate_rol_results_name, migrations.RunPython.noop
        ),
    ]

# Generated by Django 4.2.24 on 2025-09-25 13:33

from django.db import migrations, models

import openforms.authentication.models


class Migration(migrations.Migration):
    replaces = [
        ("of_authentication", "0002_add_authentication_context_mandate_fields"),
        (
            "of_authentication",
            "0003_authinfo_legal_subject_service_restriction_and_more",
        ),
        ("of_authentication", "0004_remove_authinfo_machtigen"),
        ("of_authentication", "0005_authinfo_additional_claims"),
        (
            "of_authentication",
            "0006_alter_authinfo_acting_subject_identifier_type_and_more",
        ),
        ("of_authentication", "0007_alter_authinfo_id_alter_registratorinfo_id"),
        (
            "of_authentication",
            "0008_alter_authinfo_acting_subject_identifier_type_and_more",
        ),
    ]

    dependencies = [
        ("of_authentication", "0001_initial_to_openforms_v230"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="authinfo",
            name="machtigen",
        ),
        migrations.AddField(
            model_name="authinfo",
            name="acting_subject_identifier_type",
            field=models.CharField(
                blank=True,
                choices=[("opaque", "Opaque"), ("bsn", "BSN")],
                help_text="The identifier type determines how to interpret the identifier value.",
                max_length=50,
                verbose_name="acting subject identifier type",
            ),
        ),
        migrations.AddField(
            model_name="authinfo",
            name="acting_subject_identifier_value",
            field=models.CharField(
                blank=True,
                help_text="(Contextually) unique identifier for the acting subject.",
                max_length=250,
                verbose_name="acting subject identifier",
            ),
        ),
        migrations.AddField(
            model_name="authinfo",
            name="legal_subject_identifier_type",
            field=models.CharField(
                blank=True,
                choices=[
                    ("bsn", "BSN"),
                    ("kvk", "KvK number"),
                    ("rsin", "RSIN"),
                    ("opaque", "Opaque"),
                ],
                help_text="The identifier type determines how to interpret the identifier value.",
                max_length=50,
                verbose_name="legal subject identifier type",
            ),
        ),
        migrations.AddField(
            model_name="authinfo",
            name="legal_subject_identifier_value",
            field=models.CharField(
                blank=True,
                help_text="(Contextually) unique identifier for the legal subject.",
                max_length=250,
                verbose_name="legal subject identifier",
            ),
        ),
        migrations.AddField(
            model_name="authinfo",
            name="mandate_context",
            field=models.JSONField(
                blank=True,
                help_text="If a mandate is in play, then the mandate context must be provided. The details are tracked here, in line with the authentication context data JSON schema definition.",
                null=True,
                verbose_name="mandate context",
            ),
        ),
        migrations.AddConstraint(
            model_name="authinfo",
            constraint=openforms.authentication.models.ConjointConstraint(
                fields=(
                    "acting_subject_identifier_type",
                    "acting_subject_identifier_value",
                ),
                name="acting_subject_integrity",
            ),
        ),
        migrations.AddConstraint(
            model_name="authinfo",
            constraint=openforms.authentication.models.ConjointConstraint(
                fields=(
                    "legal_subject_identifier_type",
                    "legal_subject_identifier_value",
                ),
                name="legal_subject_integrity",
            ),
        ),
        migrations.AddConstraint(
            model_name="authinfo",
            constraint=models.CheckConstraint(
                check=models.Q(
                    models.Q(
                        ("legal_subject_identifier_value", ""),
                        ("mandate_context__isnull", True),
                    ),
                    models.Q(
                        models.Q(("legal_subject_identifier_value", ""), _negated=True),
                        ("mandate_context__isnull", False),
                    ),
                    _connector="OR",
                ),
                name="mandate_context_not_null",
            ),
        ),
        migrations.AddField(
            model_name="authinfo",
            name="legal_subject_service_restriction",
            field=models.CharField(
                blank=True,
                help_text="Optional service restriction information within the bigger legal subject.",
                max_length=250,
                verbose_name="legal subject service restriction",
            ),
        ),
        migrations.AddField(
            model_name="authinfo",
            name="additional_claims",
            field=models.JSONField(
                default=dict,
                help_text="Additional claims, configurable in form OIDC configuration, returned by the authentication plugin.",
                verbose_name="additional claims",
            ),
        ),
        migrations.AlterField(
            model_name="authinfo",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="registratorinfo",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="authinfo",
            name="attribute",
            field=models.CharField(
                choices=[
                    ("bsn", "BSN"),
                    ("kvk", "KvK number"),
                    ("pseudo", "Pseudo ID"),
                    ("employee_id", "Employee ID"),
                ],
                help_text="Name of the attribute returned by the authentication plugin.",
                max_length=50,
                verbose_name="attribute",
            ),
        ),
        migrations.AlterField(
            model_name="registratorinfo",
            name="attribute",
            field=models.CharField(
                choices=[
                    ("bsn", "BSN"),
                    ("kvk", "KvK number"),
                    ("pseudo", "Pseudo ID"),
                    ("employee_id", "Employee ID"),
                ],
                help_text="Name of the attribute returned by the authentication plugin.",
                max_length=50,
                verbose_name="attribute",
            ),
        ),
    ]
